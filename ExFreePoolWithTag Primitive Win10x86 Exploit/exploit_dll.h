#include <Windows.h>
#include <stdio.h>

#include "pool_21H2_x86.h"
#include "pool_enums.h"

#define DEVICE "\\\\.\\ExFreePoolPrimitive"
#define TARGET_IOCTL 2228227

#define HEAP_OBJECT_COUNT 8192

#define POOL_TAG 0x6E657645 // Even

void exploit_pool();
void initialize_pool_header(PPOOL_HEADER input_pool_header);
void initialize_object_header_quota(POBJECT_HEADER_QUOTA input_object_header_quota);
void initialize_quad(PQUAD input_quad);
void initialize_ex_push_lock(PEX_PUSH_LOCK input_ex_push_lock);
void initialize_object_header(POBJECT_HEADER input_object_header, PEX_PUSH_LOCK input_ex_push_lock, PVOID input_heap_allocation_address, PQUAD input_quad);

void initialize_pool_structs(char* address, PPOOL_HEADER input_pool_header, POBJECT_HEADER_QUOTA input_object_header_quota, PEX_PUSH_LOCK input_push_lock, PQUAD input_quad, POBJECT_HEADER input_object_header);
void build_pool_chunk(char* fake_pool_memory_page, POOL_HEADER pool_header, OBJECT_HEADER_QUOTA object_header_quota, OBJECT_HEADER object_header);