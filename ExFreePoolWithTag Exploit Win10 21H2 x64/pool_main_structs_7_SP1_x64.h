#include <Windows.h>

typedef struct _POOL_HEADER_W7_SP1
{
    union {
        ULONG Ulong1; // Don't use...
        struct {
            UCHAR PreviousSize : 8;
            UCHAR PoolIndex : 8;
            UCHAR BlockSize : 8;
            UCHAR PoolType : 8;
        };
    };
    ULONG PoolTag;
    union {
        PVOID ProcessBilled; // Should be PEPROCESS
        USHORT AllocatorBackTraceIndex;
    };
    USHORT PoolTagHash;
} POOL_HEADER_W7_SP1, * PPOOL_HEADER_W7_SP1;

typedef struct _OBJECT_HEADER_QUOTA_INFO_W7_SP1
{
    ULONG PagedPoolCharge;
    ULONG NonPagedPoolCharge;
    ULONG SecurityDescriptorCharge;
    PVOID SecurityDescriptorQuotaBlock;
    ULONGLONG Reserved;
} OBJECT_HEADER_QUOTA_INFO_W7_SP1, * POBJECT_HEADER_QUOTA_INFO_W7_SP1;

typedef struct _OBJECT_HEADER_W7_SP1
{
    LONGLONG PointerCount;
    union {
        LONGLONG HandleCount;
        PVOID NextToFree;
    };
    EX_PUSH_LOCK_W7_SP1 Lock;
    UCHAR TypeIndex;
    UCHAR TraceFlags;
    UCHAR InfoMask;
    UCHAR Flags;
    union {
        POBJECT_CREATE_INFORMATION_W7_SP1 ObjectCreateInfo;
        PVOID QuotaBlockCharged;
    };
    PVOID SecurityDescriptor;
    QUAD_W7_SP1 Body;
} OBJECT_HEADER_W7_SP1, * POBJECT_HEADER_W7_SP1;

typedef struct _EX_PUSH_LOCK_W7_SP1
{
    union {
        ULONGLONG Value;
        PVOID Ptr;
        struct {
            UCHAR Locked : 1;
            UCHAR Waiting : 1;
            UCHAR Waking : 1;
            UCHAR MultipleShared : 1;
            ULONGLONG Shared : 60;
        };
    };
} EX_PUSH_LOCK_W7_SP1, * PEX_PUSH_LOCK_W7_SP1;

typedef struct _OBJECT_CREATE_INFORMATION_W7_SP1
{
    ULONG Attributes;
    PVOID RootDirectory;
    CHAR ProbeMode;
    ULONG PagedPoolCharge;
    ULONG NonPagedPoolCharge;
    ULONG SecurityDescriptorCharge;
    PVOID SecurityDescriptor;
    PSECURITY_QUALITY_OF_SERVICE SecurityQos;
    SECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;
} OBJECT_CREATE_INFORMATION_W7_SP1, * POBJECT_CREATE_INFORMATION_W7_SP1;

typedef struct _QUAD_W7_SP1
{
    union {
        LONGLONG UseThisFieldToCopy;
        FLOAT DoNotUseThisField;
    };
} QUAD_W7_SP1, * PQUAD_W7_SP1;